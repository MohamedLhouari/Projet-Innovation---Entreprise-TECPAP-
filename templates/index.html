<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent IA - Am√©lioration OEE | TECPAP</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo-section">
                    <img src="{{ url_for('static', filename='images/tecpap-logo.png') }}" alt="Logo TECPAP" class="company-logo">
                    <div class="title-section">
                        <h1 class="title">Agent IA de D√©cision OEE</h1>
                        <p class="subtitle">Syst√®me Intelligent d'Optimisation de Production - TECPAP</p>
                    </div>
                </div>
                <div class="status-indicator" style="display: flex; align-items: center; gap: 20px;">
                    <a href="/" style="background: white; color: #6B4423; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.3s; border: 2px solid #6B4423;">‚Üê Accueil</a>
                    <a href="/admin" style="background: #7CB342; color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.3s;">Administration</a>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span class="status-dot active"></span>
                        <span class="status-text">Syst√®me Op√©rationnel</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <button class="tab-button active" data-tab="dashboard">Dashboard</button>
            <button class="tab-button" data-tab="predictions">Pr√©dictions</button>
            <button class="tab-button" data-tab="recommendations">Recommandations</button>
            <button class="tab-button" data-tab="speed-optimization">Optimisation Vitesse</button>
            <button class="tab-button" data-tab="anomalies">Anomalies</button>
            <button class="tab-button" data-tab="analytics">Analytics</button>
        </nav>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
            <!-- KPI Cards -->
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-header">
                        <h3 class="kpi-title">Ligne 1 (L1)</h3>
                        <span class="kpi-badge status-good">Running</span>
                    </div>
                    <div class="kpi-value" id="l1-oee">--</div>
                    <div class="kpi-label">OEE Actuel</div>
                    <div class="kpi-details">
                        <div class="detail-item">
                            <span class="detail-label">Disponibilit√©:</span>
                            <span class="detail-value" id="l1-availability">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Performance:</span>
                            <span class="detail-value" id="l1-performance">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Qualit√©:</span>
                            <span class="detail-value" id="l1-quality">--</span>
                        </div>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <h3 class="kpi-title">Ligne 2 (L2)</h3>
                        <span class="kpi-badge status-good">Running</span>
                    </div>
                    <div class="kpi-value" id="l2-oee">--</div>
                    <div class="kpi-label">OEE Actuel</div>
                    <div class="kpi-details">
                        <div class="detail-item">
                            <span class="detail-label">Disponibilit√©:</span>
                            <span class="detail-value" id="l2-availability">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Performance:</span>
                            <span class="detail-value" id="l2-performance">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Qualit√©:</span>
                            <span class="detail-value" id="l2-quality">--</span>
                        </div>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <h3 class="kpi-title">Ligne 3 (L3)</h3>
                        <span class="kpi-badge status-good">Running</span>
                    </div>
                    <div class="kpi-value" id="l3-oee">--</div>
                    <div class="kpi-label">OEE Actuel</div>
                    <div class="kpi-details">
                        <div class="detail-item">
                            <span class="detail-label">Disponibilit√©:</span>
                            <span class="detail-value" id="l3-availability">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Performance:</span>
                            <span class="detail-value" id="l3-performance">--</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Qualit√©:</span>
                            <span class="detail-value" id="l3-quality">--</span>
                        </div>
                    </div>
                </div>

                <div class="kpi-card recommendation-card" style="background: linear-gradient(135deg, #f9fef9 0%, #ffffff 100%); border: 2px solid var(--success-color);">
                    <div class="kpi-header">
                        <h3 class="kpi-title" style="font-size: 20px; font-weight: 700; color: var(--success-color);">Recommandation IA</h3>
                        <span class="kpi-badge status-ai" style="background: var(--success-color); color: white; font-weight: 600;">IA Active</span>
                    </div>
                    <div class="recommendation-content" style="padding: 20px; font-size: 15px;">
                        <div class="recommended-line" id="recommended-line" style="font-size: 24px; font-weight: 700; color: var(--primary-color); margin-bottom: 15px;">--</div>
                        <div class="recommendation-score" style="font-size: 16px; font-weight: 600; color: var(--success-color); margin-bottom: 15px;">
                            Score: <span id="recommendation-score">--</span>
                        </div>
                        <div class="recommendation-reason" id="recommendation-reason" style="font-size: 14px; line-height: 1.6; color: var(--text-primary);">
                            Analyse en cours...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Alerts Section -->
            <div class="alerts-section" id="alerts-container">
                <h2 class="section-title">Alertes Actives</h2>
                <div class="alerts-grid" id="alerts-grid">
                    <div class="alert-placeholder">Chargement des alertes...</div>
                </div>
            </div>

            <!-- Chart Section -->
            <div class="chart-section">
                <h2 class="section-title">√âvolution OEE - 24 Derni√®res Heures</h2>
                <canvas id="oeeChart"></canvas>
            </div>
        </div>

        <!-- Predictions Tab -->
        <div class="tab-content" id="predictions">
            <div class="predictions-header">
                <h2 class="section-title">Pr√©dictions OEE - 7 Prochains Jours</h2>
                <div class="line-selector">
                    <button class="selector-btn active" data-line="L1">Ligne 1</button>
                    <button class="selector-btn" data-line="L2">Ligne 2</button>
                    <button class="selector-btn" data-line="L3">Ligne 3</button>
                </div>
            </div>
            
            <div class="predictions-content">
                <div class="predictions-chart">
                    <canvas id="predictionsChart"></canvas>
                </div>
                
                <div class="predictions-table">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>OEE Pr√©dit</th>
                                <th>Confiance</th>
                                <th>Tendance</th>
                            </tr>
                        </thead>
                        <tbody id="predictions-tbody">
                            <tr><td colspan="4">Chargement...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Recommendations Tab -->
        <div class="tab-content" id="recommendations">
            <div class="recommendations-section">
                <h2 class="section-title">Simulation de Sc√©narios de Production</h2>
                
                <div class="scenario-config">
                    <div class="config-group">
                        <label>Type de Produit:</label>
                        <select id="product-type">
                            <option value="Fond_Plat">Fond Plat</option>
                            <option value="Fond_Carre_Sans_Poignees">Fond Carr√© Sans Poign√©es</option>
                            <option value="Fond_Carre_Poignees_Plates">Fond Carr√© avec Poign√©es Plates</option>
                            <option value="Fond_Carre_Poignees_Torsadees">Fond Carr√© avec Poign√©es Torsad√©es</option>
                        </select>
                    </div>
                    <div class="config-group">
                        <label>Quantit√©:</label>
                        <input type="number" id="quantity-input" value="1000" min="100" step="100">
                    </div>
                    <button class="btn-primary" id="simulate-btn">Simuler les Sc√©narios</button>
                </div>

                <div class="scenarios-grid" id="scenarios-grid">
                    <!-- Scenarios will be populated here -->
                </div>

                <div class="comparison-section" id="comparison-section" style="display:none;">
                    <h3 class="subsection-title">Analyse Comparative</h3>
                    <div class="comparison-grid" id="comparison-grid">
                        <!-- Comparison data will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Speed Optimization Tab -->
        <div class="tab-content" id="speed-optimization">
            <div class="speed-optimization-section">
                <h2 class="section-title">Optimisation de Vitesse Machine (Sweet Spot Finder)</h2>
                <p class="section-description">
                    Trouvez la vitesse optimale pour maximiser votre production nette (production √ó qualit√©). 
                    Le syst√®me pr√©dit l'impact de chaque vitesse sur la production et les d√©fauts pour identifier le "Sweet Spot".
                </p>
                
                <!-- Configuration -->
                <div class="optimization-config">
                    <div class="config-group">
                        <label>Ligne de Production:</label>
                        <select id="speed-line-select">
                            <option value="L1">Ligne 1 (L1)</option>
                            <option value="L2">Ligne 2 (L2)</option>
                            <option value="L3">Ligne 3 (L3)</option>
                        </select>
                    </div>
                    <div class="config-group">
                        <label>Type de Sac Kraft:</label>
                        <select id="speed-product-select">
                            <option value="Fond_Plat">Fond Plat</option>
                            <option value="Fond_Carre_Sans_Poignees">Fond Carr√© Sans Poign√©es</option>
                            <option value="Fond_Carre_Poignees_Plates">Fond Carr√© Poign√©es Plates</option>
                            <option value="Fond_Carre_Poignees_Torsadees">Fond Carr√© Poign√©es Torsad√©es</option>
                        </select>
                    </div>
                    <button class="btn-primary" id="optimize-speed-btn">Trouver le Sweet Spot</button>
                </div>

                <!-- R√©sultats -->
                <div id="optimization-results" style="display:none;">
                    <!-- Recommandation principale -->
                    <div class="recommendation-card">
                        <h3 class="subsection-title">Recommandation IA</h3>
                        <div class="recommendation-content" id="speed-recommendation">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Graphique Sweet Spot -->
                    <div class="chart-container">
                        <h3 class="subsection-title">Courbe d'Optimisation (Sweet Spot)</h3>
                        <canvas id="sweetSpotChart"></canvas>
                    </div>

                    <!-- M√©triques d√©taill√©es -->
                    <div class="metrics-grid" id="speed-metrics">
                        <!-- Populated by JS -->
                    </div>

                    <!-- Comparaison multi-lignes -->
                    <div class="comparison-section">
                        <h3 class="subsection-title">üîÑ Comparaison Toutes Lignes</h3>
                        <button class="btn-secondary" id="compare-all-lines-btn">Comparer L1 vs L2 vs L3</button>
                        <div class="comparison-grid" id="lines-comparison" style="display:none;">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Anomalies Tab -->
        <div class="tab-content" id="anomalies">
            <div class="anomalies-section">
                <h2 class="section-title">Base de Connaissances des Anomalies</h2>
                
                <div class="anomaly-search">
                    <div class="search-box">
                        <input type="text" id="anomaly-search-input" placeholder="D√©crire le sympt√¥me ou l'anomalie...">
                        <button class="btn-primary" id="search-anomaly-btn">Rechercher Solutions Similaires</button>
                    </div>
                </div>

                <div class="search-results" id="search-results" style="display:none;">
                    <h3 class="subsection-title">Cas Similaires Trouv√©s</h3>
                    <div id="similar-cases">
                        <!-- Results will be populated here -->
                    </div>
                </div>

                <div class="recent-anomalies">
                    <h3 class="subsection-title">Anomalies R√©centes (30 Derniers Jours)</h3>
                    <div class="anomalies-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Ligne</th>
                                    <th>Machine</th>
                                    <th>Sympt√¥me</th>
                                    <th>Cause</th>
                                    <th>Solution</th>
                                    <th>Impact OEE</th>
                                    <th>Temps R√©solution</th>
                                </tr>
                            </thead>
                            <tbody id="anomalies-tbody">
                                <tr><td colspan="8">Chargement...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div class="tab-content" id="analytics">
            <div class="analytics-section">
                <h2 class="section-title">Analyse Historique et Impact</h2>
                
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3>Impact Potentiel d'Am√©lioration</h3>
                        <div class="impact-calculator">
                            <div class="calc-input">
                                <label>OEE Actuel Moyen:</label>
                                <input type="number" id="current-oee-input" value="74" step="0.1">%
                            </div>
                            <div class="calc-input">
                                <label>Am√©lioration Cible:</label>
                                <input type="number" id="improvement-input" value="3" step="0.5" min="0.5" max="10">%
                            </div>
                            <button class="btn-primary" id="calculate-impact-btn">Calculer l'Impact</button>
                            
                            <div class="impact-results" id="impact-results" style="display:none;">
                                <div class="result-item">
                                    <span class="result-label">OEE Cible:</span>
                                    <span class="result-value" id="target-oee">--</span>%
                                </div>
                                <div class="result-item">
                                    <span class="result-label">Gain Annuel (heures):</span>
                                    <span class="result-value" id="gain-hours">--</span>h
                                </div>
                                <div class="result-item highlight">
                                    <span class="result-label">Gain Productivit√©:</span>
                                    <span class="result-value" id="gain-percent">--</span>%
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3>Performance par Ligne (30 Jours)</h3>
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>

                <div class="historical-chart">
                    <h3>√âvolution OEE - 90 Derniers Jours</h3>
                    <canvas id="historicalChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Agent IA de D√©cision pour l'Am√©lioration de l'OEE - D√©velopp√© pour TECPAP</p>
            <p class="footer-meta">Derni√®re mise √† jour: <span id="last-update">--</span></p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
